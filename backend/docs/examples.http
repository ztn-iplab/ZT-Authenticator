### Health
GET https://localhost:8000/health

### Create user
POST https://localhost:8000/users
Content-Type: application/json

{"email":"alice@example.com"}

### Create relying party
POST https://localhost:8000/relying-parties
Content-Type: application/json

{"rp_id":"example.com","display_name":"Example RP"}

### Create device
POST https://localhost:8000/devices
Content-Type: application/json

{"user_id":"<USER_ID>","device_label":"Test Phone","platform":"android"}

### Create device key
POST https://localhost:8000/device-keys
Content-Type: application/json

{"device_id":"<DEVICE_ID>","rp_id":"<RP_UUID>","key_type":"ed25519","public_key":"BASE64_PUBLIC_KEY"}

### Enrollment (one request)
POST https://localhost:8000/enroll
Content-Type: application/json

{
  "email": "carol@example.com",
  "device_label": "Research Phone",
  "platform": "android",
  "rp_id": "example.com",
  "rp_display_name": "Example RP",
  "key_type": "ed25519",
  "public_key": "BASE64_PUBLIC_KEY"
}

### TOTP register (server-generated secret)
POST https://localhost:8000/totp/register
Content-Type: application/json

{
  "user_id": "<USER_ID>",
  "rp_id": "example.com",
  "account_name": "alice@example.com",
  "issuer": "Example"
}

### TOTP verify
POST https://localhost:8000/totp/verify
Content-Type: application/json

{
  "user_id": "<USER_ID>",
  "rp_id": "example.com",
  "otp": "123456"
}

### Classic login (email + otp + rp_id + device_id)
POST https://localhost:8000/login
Content-Type: application/json

{
  "email": "alice@example.com",
  "otp": "123456"
}

### Login form page
GET https://localhost:8000/login-form

### Login status (poll from web client)
GET https://localhost:8000/login/status?login_id=<LOGIN_ID>

### Login pending (device polls)
GET https://localhost:8000/login/pending?user_id=<USER_ID>

### Login approve (device proof)
POST https://localhost:8000/login/approve
Content-Type: application/json

{
  "login_id": "<LOGIN_ID>",
  "device_id": "<DEVICE_ID>",
  "rp_id": "example.com",
  "otp": "123456",
  "nonce": "<NONCE>",
  "signature": "<DEVICE_SIGNATURE>"
}

### Login recovery (fallback)
POST https://localhost:8000/login/recover
Content-Type: application/json

{
  "email": "alice@example.com",
  "recovery_code": "<RECOVERY_CODE>"
}

### Login deny (explicit device rejection)
POST https://localhost:8000/login/deny
Content-Type: application/json

{
  "login_id": "<LOGIN_ID>",
  "reason": "user_denied"
}

### Recovery code verify (consumes code)
POST https://localhost:8000/totp/recovery/verify
Content-Type: application/json

{
  "user_id": "<USER_ID>",
  "code": "<RECOVERY_CODE>"
}

### ZT challenge (nonce)
POST https://localhost:8000/zt/challenge
Content-Type: application/json

{
  "device_id": "<DEVICE_ID>",
  "rp_id": "example.com"
}

### ZT verify (signed proof)
# Signature is Ed25519 over: "<nonce>|<device_id>|<rp_id>|<otp>"
# public_key is stored during enrollment as base64 raw 32-byte public key.
POST https://localhost:8000/zt/verify
Content-Type: application/json

{
  "user_id": "<USER_ID>",
  "device_id": "<DEVICE_ID>",
  "rp_id": "example.com",
  "otp": "123456",
  "device_proof": {
    "nonce": "<NONCE_FROM_CHALLENGE>",
    "signature": "<BASE64_SIGNATURE>"
  }
}

### Rotate device key (public key update)
POST https://localhost:8000/zt/rotate-key
Content-Type: application/json

{
  "device_id": "<DEVICE_ID>",
  "rp_id": "example.com",
  "key_type": "p256",
  "public_key": "<BASE64_PUBLIC_KEY>"
}

### Enrollment QR (PNG)
GET https://localhost:8000/enroll/qr?rp_id=example.com&email=alice@example.com&issuer=Example&account_name=alice@example.com&rp_display_name=Example%20RP&device_label=Research%20Phone

### Enrollment QR page (HTML)
GET https://localhost:8000/enroll/qr-page?rp_id=example.com&email=alice@example.com&issuer=Example&account_name=alice@example.com&rp_display_name=Example%20RP&device_label=Research%20Phone
